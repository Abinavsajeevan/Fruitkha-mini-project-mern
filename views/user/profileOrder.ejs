


<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Fruitkha - Slider Version</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="user/assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="user/assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="user/assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="user/assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="user/assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="user/assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="user/assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="user/assets/css/responsive.css">
	<!-- bootsrap icon cdn link -->
	 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <style>
    body { background-color:#f8f9fa; }
    h3 { color:#F28123; font-weight:bold; }
    .order-box {
      border:2px solid #F28123;
      border-radius:8px;
      background-color:#fff;
      padding:1rem;
      margin-bottom:1.5rem;
    }
    .order-header {
      display:flex;
      justify-content:space-between;
      font-weight:bold;
      color:#F28123;
      margin-bottom:.25rem;
    }
    .badge-custom {
      background-color:#F28123;
      color:#fff;
      border-radius:4px;
      padding:2px 8px;
      font-size:.8rem;
    }
    table {
      background-color:#343a40;
      color:#fff;
      border-radius:4px;
      overflow:hidden;
    }
    table thead th {
      color:#F28123;
      border:none;
    }
    .btn-cancel {
      background-color:#F28123;
      color:#fff;
      border:none;
      border-radius:20px;
      padding:6px 16px;
      font-size:.9rem;
      transition:background-color .3s ease;
    }
    .btn-cancel:hover { background-color:#d46d1d; }
  </style>




</head>
<body>
	
	<!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->
	
	<!-- header -->
	<%- include('partials/header') %>
	<!-- end header -->

    	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
				    <p>Your Full Details</p>
						<h1>Profile </h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

<div class="container my-5">
  <h2 class="text-center mb-4" style="color:#F28123;">My Profile</h2>

  <!-- Navigation (changed from tabs to links) -->
  <ul class="nav nav-tabs justify-content-center border-0" id="profileTabs">
    <li class="nav-item">
      <a href="/profile" class="nav-link  fw-bold text-dark"
         style=" border:2px solid #F28123; border-bottom:none; border-radius:10px 10px 0 0;">
        Profile Info
      </a>
    </li>
    <li class="nav-item">
      <a href="/profileOrder" class="nav-link active fw-bold "
         style="color:#F28123; background-color: #051922; border:2px solid #F28123; border-bottom:none; border-radius:10px 10px 0 0;">
        Orders
      </a>
    </li>
    <li class="nav-item">
      <a href="/profileAddress" class="nav-link fw-bold text-dark"
         style="border:2px solid #F28123; border-bottom:none; border-radius:10px 10px 0 0;">
        Addresses
      </a>
    </li>
    <li class="nav-item">
      <a href="/profileSetting" class="nav-link fw-bold text-dark"
         style="border:2px solid #F28123; border-bottom:none; border-radius:10px 10px 0 0;">
        Settings
      </a>
    </li>
  </ul>


<div class="container my-5">
  <h3 class="mb-4">My Orders</h3>

  <!-- Order 3 with Cancel -->
   <% orders.forEach(order => { %>
  <div class="order-box shadow-sm">
    <div class="order-header">
      <span>Order #<%= order.id %></span>
      <span class="badge-custom"><%= order.orderStatus %></span>
    </div>
    <div class="d-flex flex-wrap justify-content-between">
      <p class="mb-1"><strong>Order Date:</strong> <%= order.orderDate %></p>
      <% if(order.deliveredAt) { %>
        <p class="mb-1"><strong>Delivery Date:</strong> <%= order.deliveredAt %></p>
      <%} %>
    </div>

    <div class="d-flex flex-wrap justify-content-between">
      <p class="mb-1"><strong>Total:</strong> ₹<%= order.totalAmount %></p>
      <p class="mb-1"><strong>Payment Mode:</strong> <%= order.paymentMethod %></p>
    </div>


    <table class="table table-dark table-striped mt-3">
      <thead>
        <tr>
          <th>Product</th><th>Qty</th><th>Price</th>
        </tr>
      </thead>
      <tbody>
        <% order.items.forEach(item => { %>
        <tr><td><%= item.name %></td><td><%= item.quantity %> kg</td><td>₹<%= item.total %></td></tr>
        <%}) %>
      </tbody>
    </table>
    <% if(order.orderStatus !== 'delivered' && order.orderStatus !== 'cancelled') { %>
  <button 
    class="btn btn-cancel mt-2 cancel-order-btn" 
    data-id="<%= order._id %>">
    <i class="bi bi-x-circle"></i> Cancel Order
  </button>
    <% } %>
  </div>
  <%}) %>
</div>

</div>

	<%- include('partials/footer') %>

  <!-- Cancel Order Modal -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-2 border-warning">
      <div class="modal-header">
        <h5 class="modal-title text-warning fw-bold" id="cancelModalLabel">Cancel Order</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="fw-semibold mb-2">Please select a reason for cancellation:</p>
        <form id="cancelReasonForm">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="reason" value="Ordered by mistake" id="reason1" required>
            <label class="form-check-label" for="reason1">Ordered by mistake</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="reason" value="Found cheaper elsewhere" id="reason2">
            <label class="form-check-label" for="reason2">Found cheaper elsewhere</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="reason" value="Delivery taking too long" id="reason3">
            <label class="form-check-label" for="reason3">Delivery taking too long</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="reason" value="Changed my mind" id="reason4">
            <label class="form-check-label" for="reason4">Changed my mind</label>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="reason" value="Other" id="reason5">
            <label class="form-check-label" for="reason5">Other</label>
          </div>
          <textarea class="form-control" id="otherReason" rows="2" placeholder="Please specify..." disabled></textarea>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-cancel" id="confirmCancelBtn">Confirm Cancel</button>
      </div>
    </div>
  </div>
</div>
	
	<!-- jquery -->
	<script src="user/assets/js/jquery-1.11.3.min.js"></script>
	<!-- bootstrap -->
	<script src="user/assets/bootstrap/js/bootstrap.min.js"></script>
	<!-- count down -->
	<script src="user/assets/js/jquery.countdown.js"></script>
	<!-- isotope -->
	<script src="user/assets/js/jquery.isotope-3.0.6.min.js"></script>
	<!-- waypoints -->
	<script src="user/assets/js/waypoints.js"></script>
	<!-- owl carousel -->
	<script src="user/assets/js/owl.carousel.min.js"></script>
	<!-- magnific popup -->
	<script src="user/assets/js/jquery.magnific-popup.min.js"></script>
	<!-- mean menu -->
	<script src="user/assets/js/jquery.meanmenu.min.js"></script>
	<!-- sticker js -->
	<script src="user/assets/js/sticker.js"></script>
	<!-- main js -->
	<script src="user/assets/js/main.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  let selectedOrderId = null;
  const cancelModal = new bootstrap.Modal(document.getElementById('cancelModal'));
  const confirmCancelBtn = document.getElementById('confirmCancelBtn');
  const otherReasonField = document.getElementById('otherReason');

  // Enable textarea when "Other" is selected
  document.querySelectorAll('input[name="reason"]').forEach(radio => {
    radio.addEventListener('change', () => {
      if (radio.value === 'Other') {
        otherReasonField.disabled = false;
        otherReasonField.focus();
      } else {
        otherReasonField.disabled = true;
        otherReasonField.value = '';
      }
    });
  });

  // Open modal when clicking cancel button
  document.querySelectorAll('.cancel-order-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      selectedOrderId = btn.getAttribute('data-id');
      cancelModal.show();
    });
  });

  // Confirm cancellation
  confirmCancelBtn.addEventListener('click', async () => {
    const reasonInput = document.querySelector('input[name="reason"]:checked');
    if (!reasonInput) {
      alert('Please select a reason for cancellation.');
      return;
    }

    const reason = reasonInput.value === 'Other' ? otherReasonField.value.trim() : reasonInput.value;
    if (reasonInput.value === 'Other' && !reason) {
      alert('Please specify your reason.');
      return;
    }

    try {
      const res = await fetch(`/cancel-order/${selectedOrderId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status: 'cancelled', reason })
      });

      const data = await res.json();
      if (res.ok) {
        alert('Order cancelled successfully');
        cancelModal.hide();
        location.reload();
      } else {
        alert(data.message || 'Failed to cancel order');
      }
    } catch (err) {
      console.error(err);
      alert('Something went wrong');
    }
  });
</script>


</body>
</html>





  









