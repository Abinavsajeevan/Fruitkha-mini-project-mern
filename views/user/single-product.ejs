<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Single Product</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="/user/assets/img/favicon.png">
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="/user/assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="/user/assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="/user/assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="/user/assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="/user/assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="/user/assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="/user/assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="/user/assets/css/responsive.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

	<style>
		.disabled-btn {
  background-color: #cccccc !important;
  cursor: not-allowed !important;
  opacity: 0.7;
  pointer-events: none; /* Full disable */
}

.disabled-btn:hover {
  background-color: #cccccc !important;
  transform: none !important;
  box-shadow: none !important;
}

.no-image {
    color: #ff0000;        /* red text */
    font-weight: bold;     /* bold */
    font-size: 18px;       /* bigger font */
    text-align: center;    /* center in the div */
    padding: 20px 0;       /* spacing */
    background-color: #f2f2f2; /* optional background */
    border: 1px dashed #ccc;  /* optional border */
    border-radius: 5px;       /* rounded corners */
}
/* .product-img {
    width: 150px;
    height: 150px;
    object-fit: cover;
    margin: 5px;
} */

.gallery-slider {
    position: relative;
    width: 100%;
    height: 400px; /* adjust as needed */
    overflow: hidden;
}

.gallery-slider img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
}

.gallery-slider img.active {
    display: block;
}

.prev-btn, .next-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: rgba(0,0,0,0.5);
    color: white;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 20px;
    border-radius: 3px;
    z-index: 10;
}

.prev-btn { left: 10px; opacity: 0.6;}
.next-btn { right: 10px; opacity: 0.6; }


	</style>

</head>
<body>
	
	<!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->
	
	<%- include('partials/header') %>
	
	<!-- end search arewa -->
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>See more Details</p>
						<h1>Single Product</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<!-- single product -->
	<div class="single-product mt-150 mb-150">
		<div class="container">
			<div class="row">
				<div class="col-md-5">
					<div class="single-product-img">
					<% if(product.gallery && product.gallery.length > 0) { %>
						<div class="gallery-slider">
						<% product.gallery.forEach((image, index) => { %>
							<img src="<%= image %>" alt="" class="product-img <%= index === 0 ? 'active' : '' %>">
						<% }) %>
						<button class="prev-btn">&#10094;</button>
						<button class="next-btn">&#10095;</button>
						</div>
					<% } else { %>
						<p class="no-image">No image found</p>
					<% } %>
					</div>
				</div>
				<div class="col-md-7">
					<div class="single-product-content">
						<form class="wishlist-form" data-product-id="<%= product._id %>">
						<button type="button" class="wishlist-btn" style="background:none; border:none;">
							<i class="fas fa-heart"></i>
						</button>
						</form>
						<h3><%= product.name %></h3>
						<p class="single-product-pricing"><span>Per Kg</span> â‚¹<%= product.price %></p>
						<p><%= product.description %></p>
						<div class="single-product-form">
							<form class="add-to-cart-form" data-product-id="<%= product._id %>">
					<button type="button" class="cart-btn-custom add-to-cart-btn <%= product.status === 'Out Of Stock' ? 'disabled-btn' : '' %>" <%= product.status == 'Out Of Stock' ? 'disabled' : '' %>>
						<i class="fas fa-shopping-cart"></i> Add to Cart
					</button>
					</form>
					<p class="fw-bold mt-3 <%= product.status == 'In Stock'?'text-success':product.status == 'Out Of Stock'? 'text-danger':'text-warning' %>" style="font-weight: 700 !important;"><%= product.status %></p>
					
							<p><strong>Categories: </strong>Fruits, <%= product.category %></p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end single product -->

	<!-- more products -->
	<!-- <div class="more-products mb-150">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="section-title">	
						<h3><span class="orange-text">Related</span> Products</h3>
						<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquid, fuga quas itaque eveniet beatae optio.</p>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-4 col-md-6 text-center">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="/user/assets/img/products/product-img-1.jpg" alt=""></a>
						</div>
						<h3>Strawberry</h3>
						<p class="product-price"><span>Per Kg</span> 85$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 text-center">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="/user/assets/img/products/product-img-2.jpg" alt=""></a>
						</div>
						<h3>Berry</h3>
						<p class="product-price"><span>Per Kg</span> 70$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 offset-lg-0 offset-md-3 text-center">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="/user/assets/img/products/product-img-3.jpg" alt=""></a>
						</div>
						<h3>Lemon</h3>
						<p class="product-price"><span>Per Kg</span> 35$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
			</div>
		</div>
	</div> -->
	<!-- end more products -->
	 <%- include('partials/aiSuggestions', { suggestions: suggestions }) %>


	<!-- logo carousel -->
	<div class="logo-carousel-section">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="logo-carousel-inner">
						<div class="single-logo-item">
							<img src="/user/assets/img/company-logos/1.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="/user/assets/img/company-logos/2.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="/user/assets/img/company-logos/3.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="/user/assets/img/company-logos/4.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="/user/assets/img/company-logos/5.png" alt="">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end logo carousel -->

	<!-- footer -->
		<%- include('partials/footer') %>

	
	<!-- jquery -->
	<script src="/user/assets/js/jquery-1.11.3.min.js"></script>
	<!-- bootstrap -->
	<script src="/user/assets/bootstrap/js/bootstrap.min.js"></script>
	<!-- count down -->
	<script src="/user/assets/js/jquery.countdown.js"></script>
	<!-- isotope -->
	<script src="/user/assets/js/jquery.isotope-3.0.6.min.js"></script>
	<!-- waypoints -->
	<script src="/user/assets/js/waypoints.js"></script>
	<!-- owl carousel -->
	<script src="/user/assets/js/owl.carousel.min.js"></script>
	<!-- magnific popup -->
	<script src="/user/assets/js/jquery.magnific-popup.min.js"></script>
	<!-- mean menu -->
	<script src="/user/assets/js/jquery.meanmenu.min.js"></script>
	<!-- sticker js -->
	<script src="/user/assets/js/sticker.js"></script>
	<!-- main js -->
	<script src="/user/assets/js/main.js"></script>
	<script>
	//it ensure all html page is fully loaded after that other funcion will work 
	document.addEventListener("DOMContentLoaded", () => {
		const forms = document.querySelectorAll(".add-to-cart-form");

		forms.forEach(form => {
			const btn = form.querySelector(".add-to-cart-btn");

			btn.addEventListener("click", async() => {
				if (btn.disabled) return;
				const productId = form.dataset.productId;

				try {
					const response = await fetch("/shop/add-to-cart", {
						method: "POST",
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify({ productId })
					})

					const result = await response.json();

					const oldMsg = document.querySelector(".flash-message");
					if(oldMsg) oldMsg.remove();

					form.style.position = 'relative'

					const flash = document.createElement("div");
					flash.className = `flash-overlay text-center shadow-sm px-3 py-2 rounded ${
					result.success ? "bg-success" : "bg-warning"
					}`;
					flash.style.position = "absolute";
					flash.style.top = `${btn.offsetTop + btn.offsetHeight + 5}px`;
					flash.style.left = "50%";
					flash.style.transform = "translateX(-50%)";
					flash.style.color = "white";
					flash.style.fontWeight = "600";
					flash.style.zIndex = "10";
					flash.style.whiteSpace = "nowrap";
					flash.style.opacity = "0.95";
					flash.innerHTML = `
					<i class="bi ${
						result.success ? "bi-check-circle-fill" : "bi-exclamation-circle-fill"
					} me-1"></i>
					${result.message}
					`;

					form.appendChild(flash);
										
					setTimeout(() => {
						
						flash.remove()
					}, 2000);
       
				}catch(err) {
					console.error("Error:", err)
				}
			});
		});
	});
</script>

	<script>
	document.addEventListener("DOMContentLoaded", () => {
		const wishlistForms = document.querySelectorAll(".wishlist-form");

		wishlistForms.forEach(form => {
			const btn = form.querySelector(".wishlist-btn");
			const productId = form.dataset.productId;

			btn.addEventListener('click', async() => {
				try {
					const response = await fetch("/wishlist/add", {
						method: "POST",
						headers: { "Content-Type": "application/json"},
						body: JSON.stringify({productId})
					});

					const result = await response.json();

					const oldMsg = document.querySelector(".wishlist-flash");
					if(oldMsg) oldMsg.remove();

					const flash = document.createElement("div");
					flash.className = `wishlist-flash text-center shadow-sm px-3 py-2 rounded ${
					result.success ? "bg-success" : "bg-warning"
					}`;
					flash.style.position = "absolute";
					flash.style.top = `${btn.offsetTop + btn.offsetHeight + 5}px`;
					flash.style.left = "50%";
					flash.style.transform = "translateX(-50%)";
					flash.style.color = "white";
					flash.style.fontWeight = "600";
					flash.style.zIndex = "10";
					flash.style.whiteSpace = "nowrap";
					flash.style.opacity = "0.95";
					flash.innerHTML = `
					<i class="bi ${
						result.success
						? "bi-check-circle-fill"
						: "bi-exclamation-circle-fill"
					} me-1"></i>
					${result.message}
					`;

					form.style.position = 'relative';
					form.appendChild(flash);

					 setTimeout(() => flash.remove(), 2000);
				}catch(err) {
					console.error("Wishlist error:", err);
				}
			});
		});
	});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const slider = document.querySelector(".gallery-slider");
    if (!slider) return;

    const images = slider.querySelectorAll("img");
    const prevBtn = slider.querySelector(".prev-btn");
    const nextBtn = slider.querySelector(".next-btn");

    let current = 0;

    function showImage(index) {
        images.forEach(img => img.classList.remove("active"));
        images[index].classList.add("active");
    }

    prevBtn.addEventListener("click", () => {
        current = (current - 1 + images.length) % images.length;
        showImage(current);
    });

    nextBtn.addEventListener("click", () => {
        current = (current + 1) % images.length;
        showImage(current);
    });
});
</script>



</body>
</html>